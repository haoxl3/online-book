(this["webpackJsonpbook-online"]=this["webpackJsonpbook-online"]||[]).push([[0],{212:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},257:function(e,t,a){e.exports=a(579)},262:function(e,t,a){},281:function(e,t,a){},579:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),c=a(81),o=a.n(c),i=(a(262),a(48)),s=a(22),l=a(17),m=a.n(l),u=a(129),d=a(38),p=a(11),f=a(12),h=a(13),v=a(14),g=a(23),b=a.n(g),E=a(56),y=a(7),N=(a(280),a(281),a(212)),k=a.n(N),O=a(10),C=a.n(O),j=function(e){return e<10?"0"+e:e},w=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=[],n=0;n<e;n++)a[n]=t+n;return a},x=function(e){var t=e?new Date(e):new Date;return{year:t.getFullYear(),month:t.getMonth()+1}},S=function(e){if(!e.match(/^\d{4}-\d{2}-\d{2}$/))return!1;var t=new Date(e);return!Number.isNaN(t.getTime())&&t.toISOString().slice(0,10)===e},I=function(e){return e.reduce((function(e,t){return e[t.id]=t,e}),{})},D={blue:"#347eff",deepBlue:"#61dafb",green:"#28a745",red:"#dc3545",gray:"#555",lightGray:"#efefef",white:"#fff"},M=function(e){var t=e.items,a=e.onModifyItem,n=e.onDeleteItem;return r.a.createElement("ul",{className:"list-group list-group-flush"},t.map((function(e){return r.a.createElement("li",{className:"list-group-item d-flex justify-content-between align-items-center",key:e.id},r.a.createElement("span",{className:"col-1 badge badge-primary"},r.a.createElement(C.a,{className:"rounded-circle",fontSize:"30px",style:{backgroundColor:"#007bff",padding:"5px"},color:"#fff",icon:e.category.iconName})),r.a.createElement("span",{className:"col-5"},e.title),r.a.createElement("span",{className:"col-2 font-weight-bold"},"income"===e.category.type?"+":"-",e.price,"\u5143"),r.a.createElement("span",{className:"col-2"},e.date),r.a.createElement("a",{className:"col-1",onClick:function(){a(e)}},r.a.createElement(C.a,{className:"rounded-circle",fontSize:"30px",style:{backgroundColor:"#28a745",padding:"5px"},color:"#fff",icon:"ios-create-outline"})),r.a.createElement("a",{className:"col-1",onClick:function(){n(e)}},r.a.createElement(C.a,{className:"rounded-circle",fontSize:"30px",style:{backgroundColor:"#dc3545",padding:"5px"},color:"#fff",icon:"ios-close"})))})))},F=function(e,t){return e===t?"nav-link active":"nav-link"},T=function(e){var t=e.activeTab,a=e.onTabChange;return r.a.createElement("ul",{className:"nav nav-tabs nav-fill my-4"},r.a.createElement("li",{className:"nav-item active"},r.a.createElement("a",{className:F(t,"list"),href:"#",onClick:function(e){e.preventDefault(),a("list")}},r.a.createElement(C.a,{className:"rounded-circle mr-2",fontSize:"25px",color:"#007bff",icon:"ios-paper"}),"\u5217\u8868\u6a21\u5f0f")),r.a.createElement("li",{className:"nav-item"},r.a.createElement("a",{className:F(t,"chart"),href:"#",onClick:function(e){e.preventDefault(),a("chart")}},r.a.createElement(C.a,{className:"rounded-circle mr-2",fontSize:"25px",color:"#007bff",icon:"ios-pie"}),"\u56fe\u8868\u6a21\u5f0f")))},L=function(e){Object(v.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).handleClick=function(e){n.node.contains(e.target)||n.setState({isOpen:!1})},n.toggleDropdown=function(e){e.preventDefault(),n.setState({isOpen:!n.state.isOpen,selectedYear:n.props.year})},n.selectedYear=function(e,t){e.preventDefault(),n.setState({selectedYear:t})},n.selectedMonth=function(e,t){e.preventDefault(),n.setState({isOpen:!1}),n.props.onChange(n.state.selectedYear,t)},n.state={isOpen:!1,selectedYear:n.props.year},n}return Object(f.a)(a,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleClick,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleClick,!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.year,n=t.month,c=this.state,o=c.isOpen,i=c.selectedYear,s=w(12,1),l=w(9,-4).map((function(e){return e+a}));return r.a.createElement("div",{className:"dropdown month-picker-component",ref:function(t){e.node=t}},r.a.createElement("h4",null,"\u9009\u62e9\u6708\u4efd"),r.a.createElement("button",{className:"btn btn-lg btn-secondary dropdown-toggle",onClick:this.toggleDropdown},"".concat(a,"\u5e74 ").concat(j(n),"\u6708")),o&&r.a.createElement("div",{className:"dropdown-menu",style:{display:"block"}},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col border-right years-range"},l.map((function(t,a){return r.a.createElement("a",{href:"#",key:a,className:t===i?"dropdown-item active":"dropdown-item",onClick:function(a){return e.selectedYear(a,t)}},t," \u5e74")}))),r.a.createElement("div",{className:"col months-range"},s.map((function(t,a){return r.a.createElement("a",{href:"#",key:a,className:t===n?"dropdown-item active":"dropdown-item",onClick:function(a){return e.selectedMonth(a,t)}},j(t)," \u6708")}))))))}}]),a}(r.a.Component),z=function(e){var t=e.onClick;return r.a.createElement("button",{className:"btn btn-primary btn-block d-flex justify-content-center align-items-center",onClick:function(e){t()}},r.a.createElement(C.a,{className:"rounded-circle",fontSize:"30px",color:"#fff",icon:"ios-add-circle"}),"\u521b\u5efa\u4e00\u6761\u65b0\u7684\u8bb0\u8d26\u8bb0\u5f55")},P=function(e){var t=e.income,a=e.outcome;return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("h5",{className:"income"},"\u6536\u5165\uff1a",r.a.createElement("span",null,t))),r.a.createElement("div",{className:"col"},r.a.createElement("h5",{className:"outcome"},"\u652f\u51fa\uff1a",r.a.createElement("span",null,a))))},V=function(){return r.a.createElement("div",{className:"loading-component text-center"},r.a.createElement(C.a,{icon:"ios-refresh",fontSize:"40px",color:"#347eff",rotate:!0}),r.a.createElement("h5",null,"\u52a0\u8f7d\u4e2d"))},Y=a(51),A=Object.keys(D).map((function(e){return D[e]})),_=function(e){var t=e.title,a=e.categoryData;return 0===a.length?r.a.createElement("h3",{className:"text-center mx-3"},t,"\u8fd8\u6ca1\u6709\u4efb\u4f55\u6570\u636e"):r.a.createElement("div",{className:"pie-chart-component"},r.a.createElement("h3",{className:"text-center mt-3"},t),r.a.createElement(Y.d,{width:"100%",height:300},r.a.createElement(Y.c,null,r.a.createElement(Y.b,{isAnimationActive:!1,data:a,dataKey:"value",cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",label:!0},a.map((function(e,t){return r.a.createElement(Y.a,{key:t,fill:A[t%A.length]})}))),r.a.createElement(Y.e,null))))},B=function(e){Object(v.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).tabChange=function(e,t){e.preventDefault(),n.setState({activeIndex:t}),n.props.onTabChange(t)},n.state={activeIndex:e.activeIndex},n}return Object(f.a)(a,[{key:"render",value:function(){var e=this,t=this.props.children,a=this.state.activeIndex;return r.a.createElement("ul",{className:"nav nav-tabs nav-fill my-4"},r.a.Children.map(t,(function(t,n){var c=a===n?"nav-link active":"nav-link";return r.a.createElement("li",{className:"nav-item"},r.a.createElement("a",{className:c,href:"#",onClick:function(t){e.tabChange(t,n)}},t))})))}}]),a}(r.a.Component),W=function(e){var t=e.children;return r.a.createElement(r.a.Fragment,null,t)},J=function(e){return function(t){return r.a.createElement(ee.Consumer,null,(function(a){var n=a.state,c=a.actions;return r.a.createElement(e,Object.assign({},t,{data:n,actions:c}))}))}},$=["list","chart"],G=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"income",a={};return e.filter((function(e){return e.category.type===t})).forEach((function(e){a[e.cid]?(a[e.cid].value+=1*e.price,a[e.cid].items.push(e.id)):a[e.cid]={name:e.category.name,value:1*e.price,items:[e.id]}})),Object.keys(a).map((function(e){return Object(s.a)({},a[e])}))},K=function(e){Object(v.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).changeView=function(e){n.setState({tabView:$[e]})},n.changeDate=function(e,t){n.props.actions.selectNewMonth(e,t)},n.modifyItem=function(e){n.props.history.push("/edit/".concat(e.id))},n.createItem=function(){n.props.history.push("/create")},n.deleteItem=function(e){n.props.actions.deleteItem(e)},n.state={tabView:$[0]},n}return Object(f.a)(a,[{key:"componentDidMount",value:function(){this.props.actions.getInitalData()}},{key:"render",value:function(){var e=this.props.data,t=e.items,a=e.categories,n=e.currentDate,c=e.isLoading,o=this.state.tabView,i=Object.keys(t).map((function(e){return t[e].category=a[t[e].cid],t[e]})),s=G(i,"outcome"),l=G(i,"income"),m=0,u=0;return i.forEach((function(e){"outcome"===e.category.type?u+=e.price:m+=e.price})),r.a.createElement(r.a.Fragment,null,r.a.createElement("header",{className:"App-header"},r.a.createElement("div",{className:"row mb-5"},r.a.createElement("img",{src:k.a,className:"App-logo",alt:"logo"})),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement(L,{year:n.year,month:n.month,onChange:this.changeDate})),r.a.createElement("div",{className:"col"},r.a.createElement(P,{income:m,outcome:u})))),r.a.createElement("div",{className:"content-area py-3 px-3"},c&&r.a.createElement(V,null),!c&&r.a.createElement(r.a.Fragment,null,r.a.createElement(B,{activeIndex:0,onTabChange:this.changeView},r.a.createElement(W,null,r.a.createElement(C.a,{className:"rounded-circle mr-2",fontSize:"25px",color:"#007bff",icon:"ios-paper"}),"\u5217\u8868\u6a21\u5f0f"),r.a.createElement(W,null,r.a.createElement(C.a,{className:"rounded-circle mr-2",fontSize:"25px",color:"#007bff",icon:"ios-pie"}),"\u56fe\u8868\u6a21\u5f0f")),r.a.createElement(T,{activeTab:o,onTabChange:this.changeView}),r.a.createElement(z,{onClick:this.createItem}),"list"===o&&r.a.createElement(M,{items:i,onModifyItem:this.modifyItem,onDeleteItem:this.deleteItem}),"chart"===o&&r.a.createElement(r.a.Fragment,null,r.a.createElement(_,{title:"\u672c\u6708\u652f\u51fa",categoryData:s}),r.a.createElement(_,{title:"\u672c\u6708\u6536\u5165",categoryData:l})))))}}]),a}(r.a.Component),R=Object(y.e)(J(K)),U=function(e){Object(v.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).selectedCategory=function(e,t){n.props.onSelectCategory(t),e.preventDefault()},n}return Object(f.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.categories,n=t.selectedCategory,c=n&&n.id;return r.a.createElement("div",{className:"category-select-component"},r.a.createElement("div",{className:"row"},a.map((function(t,a){var n=c===t.id?"category-item col-3 active":"category-item col-3";return r.a.createElement("div",{className:n,key:a,onClick:function(a){e.selectedCategory(a,t)}},r.a.createElement(C.a,{className:"rounded-circle",fontSize:"50px",color:"#555",icon:t.iconName}))}))))}}]),a}(r.a.Component),q=function(e){Object(v.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={validatePass:!0,errorMessage:""},e.sumbitForm=function(t){var a=e.props,n=a.item,r=a.onFormSubmit,c=!!n.id,o=1*e.priceInput.value.trim(),i=e.dateInput.value.trim(),l=e.titleInput.value.trim();o&&i&&l?o<0?e.setState({validatePass:!1,errorMessage:"\u4ef7\u683c\u6570\u5b57\u5fc5\u987b\u5927\u4e8e0"}):S(i)?(e.setState({validatePass:!0,errorMessage:""}),r(c?Object(s.a)({},n,{title:l,price:o,date:i}):{title:l,price:o,date:i},c)):e.setState({validatePass:!1,errorMessage:"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u65e5\u671f\u683c\u5f0f"}):e.setState({validatePass:!1,errorMessage:"\u8bf7\u8f93\u5165\u6240\u6709\u5fc5\u9009\u9879"}),t.preventDefault()},e}return Object(f.a)(a,[{key:"render",value:function(){var e=this,t=this.props.item,a=t.title,n=t.price,c=t.date;return r.a.createElement("form",{onSubmit:function(t){e.sumbitForm(t)},noValidate:!0},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"title"},"\u6807\u9898 *"),r.a.createElement("input",{type:"text",className:"form-control",id:"title",placeholder:"\u8bf7\u8f93\u5165\u6807\u9898",defaultValue:a,ref:function(t){e.titleInput=t}})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"price"},"\u4ef7\u683c *"),r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("span",{className:"input-group-text"},"\xa5")),r.a.createElement("input",{type:"number",className:"form-control",defaultValue:n,id:"price",placeholder:"\u8bf7\u8f93\u5165\u4ef7\u683c",ref:function(t){e.priceInput=t}}))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"date"},"\u65e5\u671f *"),r.a.createElement("input",{type:"date",className:"form-control",id:"date",placeholder:"\u8bf7\u8f93\u5165\u65e5\u671f",defaultValue:c,ref:function(t){e.dateInput=t}})),r.a.createElement("button",{type:"submit",className:"btn btn-primary mr-3"},"\u63d0\u4ea4"),r.a.createElement("button",{className:"btn btn-secondary",onClick:this.props.onCancelSubmit}," \u53d6\u6d88 "),!this.state.validatePass&&r.a.createElement("div",{className:"alert alert-danger mt-5",role:"alert"},this.state.errorMessage))}}]),a}(r.a.Component);q.defaultProps={item:{}};var H=q,Q=["list","chart"],X=function(e){Object(v.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(p.a)(this,a),(n=t.call(this,e)).tabChange=function(e){n.setState({selectedTab:Q[e]})},n.selectCategory=function(e){n.setState({selectedCategory:e})},n.submibForm=function(e,t){t?n.props.actions.updateItem(e,n.state.selectedCategory.id).then((function(){n.props.history.push("/")})):n.props.actions.createItem(e,n.state.selectedCategory.id).then((function(){n.props.history.push("/")}))},n.cancelSubmit=function(){n.props.history.push("/")};var r=e.match.params.id,c=e.data,o=c.categories,i=c.items;return n.state={selectedTab:r&&i[r]?o[i[r].cid].type:"outcome",selectedCategory:r&&i[r]?o[i[r].cid]:null},n}return Object(f.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.id;this.props.actions.getEditData(t).then((function(a){var n=a.editItem,r=a.categories;e.setState({selectedTab:t&&n?r[n.cid].type:"outcome",selectedCategory:t&&n?r[n.cid]:null})}))}},{key:"render",value:function(){var e=this.props.data,t=e.items,a=e.categories,n=this.props.match.params.id,c=n&&t[n]?t[n]:{},o=this.state,i=o.selectedTab,s=o.selectedCategory,l=Object.keys(a).filter((function(e){return a[e].type===i})).map((function(e){return a[e]})),m=Q.findIndex((function(e){return e===i}));return r.a.createElement("div",{className:"create-page py-3 px-3 rounded mt-3",style:{background:"#fff"}},r.a.createElement(B,{activeIndex:m,onTabChange:this.tabChange},r.a.createElement(W,null,"\u652f\u51fa"),r.a.createElement(W,null,"\u6536\u5165")),r.a.createElement(U,{categories:l,onSelectCategory:this.selectCategory,selectedCategory:s}),r.a.createElement(H,{onFormSubmit:this.submibForm,onCancelSubmit:this.cancelSubmit,item:c}))}}]),a}(r.a.Component),Z=Object(y.e)(J(X)),ee=r.a.createContext(),te=function(e){Object(v.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(p.a)(this,a),(n=t.call(this,e)).state={items:{},categories:{},isLoading:!1,currentDate:x()};var r=function(e){return function(){return n.setState({isLoading:!0}),e.apply(void 0,arguments)}};return n.actions={getInitalData:r(Object(d.a)(m.a.mark((function e(){var t,a,r,c,o,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({isLoading:!0}),t=n.state.currentDate,a="/items?monthCategory=".concat(t.year,"-").concat(t.month,"&_sort=timestamp&_order=desc"),e.next=5,Promise.all([b.a.get("/categories"),b.a.get(a)]);case 5:r=e.sent,c=Object(u.a)(r,2),o=c[0],i=c[1],n.setState({items:I(i.data),categories:I(o.data),isLoading:!1});case 8:case"end":return e.stop()}}),e)})))),selectNewMonth:r(function(){var e=Object(d.a)(m.a.mark((function e(t,a){var r,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="/items?monthCategory=".concat(t,"-").concat(a,"&_sort=timestamp&_order=desc"),e.next=3,b.a.get(r);case 3:c=e.sent,n.setState({items:I(c.data),currentDate:{year:t,month:a},isLoading:!1});case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),deleteItem:r(function(){var e=Object(d.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.delete("/items/".concat(t.id));case 2:return a=e.sent,delete n.state.items[t.id],n.setState({items:n.state.items,isLoading:!1}),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),getEditData:r(function(){var e=Object(d.a)(m.a.mark((function e(t){var a,r,c,o,l,d,p,f,h,v,g;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.state,r=a.items,c=a.categories,o=[],0===Object.keys(c).length&&o.push(b.a.get("/categories")),l=Object.keys(r).indexOf(t)>-1,t&&!l&&o.push(b.a.get("/items/".concat(t))),e.next=7,Promise.all(o);case 7:return d=e.sent,p=Object(u.a)(d,2),f=p[0],h=p[1],v=f?I(f.data):c,g=h?h.data:r[t],t?n.setState({categories:v,isLoading:!1,items:Object(s.a)({},n.state.items,Object(i.a)({},t,g))}):n.setState({categories:v,isLoading:!1}),e.abrupt("return",{categories:v,editItem:g});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),createItem:r(function(){var e=Object(d.a)(m.a.mark((function e(t,a){var r,c,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="_"+Math.random().toString(36).substr(2,9),c=x(t.date),t.monthCategory="".concat(c.year,"-").concat(c.month),t.timestamp=new Date(t.date).getTime(),e.next=6,b.a.post("/items",Object(s.a)({},t,{id:r,cid:a}));case 6:return o=e.sent,n.setState({items:Object(s.a)({},n.state.items,Object(i.a)({},r,o)),isLoading:!1}),e.abrupt("return",o.data);case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),updateItem:r(function(){var e=Object(d.a)(m.a.mark((function e(t,a){var r,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(s.a)({},t,{cid:a,timestamp:new Date(t.date).getTime()}),e.next=3,b.a.put("/items/".concat(t.id),r);case 3:return c=e.sent,n.setState({items:Object(s.a)({},n.state.items,Object(i.a)({},c.id,c.data)),isLoading:!1}),e.abrupt("return",c.data);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())},n}return Object(f.a)(a,[{key:"render",value:function(){return r.a.createElement(ee.Provider,{value:{state:this.state,actions:this.actions}},r.a.createElement(E.a,null,r.a.createElement("div",{className:"App"},r.a.createElement("ul",null,r.a.createElement(E.b,{to:"/create"},"create")),r.a.createElement("div",{className:"container pb-5"},r.a.createElement(y.a,{path:"/",exact:!0,component:R}),r.a.createElement(y.a,{path:"/create",component:Z}),r.a.createElement(y.a,{path:"/edit/:id",component:Z})))))}}]),a}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(te,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[257,1,2]]]);
//# sourceMappingURL=main.c9d07bff.chunk.js.map